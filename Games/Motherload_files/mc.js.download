var mcAsyncInterval=setInterval(function(){if(document.readyState==="complete"){clearInterval(mcAsyncInterval);if(window.mcAsyncInit&&!window.mcAsyncInit.initialised){window.mcAsyncInit.initialised=true;window.mcAsyncInit()}}},100);var MC=new function(){var a=this;this.appId;this.moduleConfigs={};this.languageCode;this.height;this.unloadFunctions=[];this._intervals=[];var c=false;var b="mc_auth_token";var d=function(){if(MC.Cookies.hasItem(b)){try{var e=MC.Cookies.getItem(b);c=JSON.parse(atob(e))}catch(f){console.log("Failed to parse auth cookie")}}};this.init=function(e){a.appId=e.app_id||0;a.languageCode=e.language_code||"en";MC.Proxy.init(function(){MC.Modules.setConfig("leaderboard",e.leaderboard||{});MC.Modules.init(e.modules||[]);d();if(typeof e.header!=="undefined"){MC.Header.init(e.header)}})};this.onProxyInit=function(){MC.Modules.proxyConfigs()};this.console=function(f,e){if(console&&console[f]){console[f](e)}};this.api=function(i,f){var h="",g={};try{h=i.request||"";g=i.parameters||{}}catch(j){}MC.Proxy.api(h,g,f)};this.resize=function(e){defaults={interval:100,height:150,minHeight:null};if(typeof e==="undefined"){e=defaults}if(!isNaN(e)){MC.console("warn","Deprecated use of MC.resize(), please use MC.resize({interval: %d}) instead",e);e={interval:e}}for(var f in defaults){if(typeof e[f]==="undefined"){e[f]=defaults[f]}}if(typeof a._intervals.resize!=="undefined"){clearInterval(a._intervals.resize)}a._intervals.resize=setInterval(function(){var g=Math.max(e.height,document.body.offsetHeight,document.documentElement.offsetHeight);if(e.minHeight!==null){var g=e.minHeight;MC.Proxy.postMessage("getAvailableHeight",null,null);if(typeof window._resizePostMessageListener==="undefined"){window._resizePostMessageListener=true;window.addEventListener("message",function(i){var h=JSON.parse(i.data);if(h.name=="availableHeight"){var j=parseInt(h.parameters,10);g=Math.max(e.minHeight,j);MC.Proxy.postMessage("resize",{height:g})}})}}else{if(a.height!==g){MC.Proxy.postMessage("resize",{height:g});a.height=g}}},e.interval)};this.login=function(g,e){var f="/dialog/login/"+a.appId+"/"+a.languageCode+"?";if(typeof g==="function"){e=g}if(typeof g==="undefined"||g===null||g.constructor!==Object){g={}}if(typeof g.facebook!=="undefined"){f+="&facebook=1"}else{if(typeof g.register!=="undefined"){f+="&register=1"}}if(typeof g.reload!=="undefined"){f+="&reload=1"}if(typeof g.iu!=="undefined"){f+="&iu="+g.iu}MC.Proxy.open(f,{name:"login",cb:function(h){if(typeof(h)==="object"&&"auth" in h){c=h.auth}if(e){e(h)}}})};this.logout=function(e){c=null;MC.Proxy.open("/dialog/logout/"+a.appId,{name:"logout",cb:e})};this.getLoginStatus=function(e){var f=this.getAuthResponse();if(f&&"access_token" in f){this.userStatus(f.access_token,function(g){if(g===true){e({status:MC.LOGIN_STATUS.CONNECTED})}else{e({status:MC.LOGIN_STATUS.UNKNOWN})}})}else{e({status:MC.LOGIN_STATUS.UNKNOWN})}};this.getAuthResponse=function(){if(c&&"access_token" in c){return c}return null};this.userStatus=function(f,e){if(typeof f==="undefined"||f===null){if(typeof e==="function"){e(false)}return}MC.Proxy.jsonp("/ajax/loginstatus",{app_id:a.appId,access_token:f},{name:"userStatus",cb:e})};this.getAvatar=function(){var f=this.getAuthResponse();var e=f&&"user_id" in f?f.user_id:0;var g=a.getServiceDomain("avatars");return g+"/avatars/"+e+"-200.png"};this.registerUnloadFunction=function(g){if(typeof g!=="function"){throw ("registerUnloadFunction only accepts callable params")}var e=a.unloadFunctions.push(g);var f=function(){var i=null;for(var k in a.unloadFunctions){try{var h=a.unloadFunctions[k]();if(typeof h==="string"&&h!==""){i=h}}catch(j){}}if(i!==null){return i}};window.onbeforeunload=f;return e};this.sendUserEvent=function(f,g){var e="/ajax/userEvent";var h=g;h.type=f;jQuery.post(e,h)};this.getServiceDomain=function(h){var g=MC.Proxy.getDomain();var e=g.match(/\/\/(.*).miniclip.com/);if(e!=null){var f=e[1];if(f=="www"){f=h}else{f=h+"-"+f}return g.replace(/(\/\/)(.*.?)(miniclip.com)/,"$1"+f+".$3")}return g}};MC.LOGIN_STATUS={CONNECTED:"connected",UNKNOWN:"unknown"};MC.Proxy=new function(){var a=this;this.lightbox=false;this.domain;this.callbacks={};this.objects={};this.state=0;this.init=function(b){a.domain=a.getDomain();a.listenerRegister();a.environment(function(c){a.lightbox=c===true;if(a.lightbox===true&&window.top===window.self){a.state=1}else{if(a.lightbox===true){a.state=2}else{a.state=3}}b()})};this.getDomain=function(){if(typeof a.domain!=="undefined"){return a.domain}var b=document.getElementsByTagName("script");var f="//www.miniclip.com";if(b&&b.length>0){for(var d in b){if(b[d].src&&b[d].src.match(/\/js\/mc\.js/)){var c=b[d].src;var e=[];if(c.indexOf("sandbox")>=0){return"//sandbox.miniclip.com"}else{if(c.indexOf("dev.miniclip.com")>=0||c.indexOf("static-dev")>=0){return"//dev.miniclip.com"}else{return f}}c=c.replace(/^https?:\/\/(.+)\/js\/mc\.js.*$/,"$1");e=c.split(".");if(e.length>3){e.shift()}return"//"+e.join(".")}}}return f};this.isMainDomain=function(){var b=location.host;return b.match(/(dev|stag|www)?\.?miniclip.com/)!==null};this.listenerRegister=function(){var c=window.addEventListener?"addEventListener":"attachEvent";var b=c==="attachEvent"?"onmessage":"message";if(c==="attachEvent"){window[c](b,a.listenerTrigger,false)}else{window[c](b,a.listenerTrigger)}};this.listenerTrigger=function(b){if(typeof b.data==="string"){if(b.origin.indexOf("miniclip.com")<0||b.data.indexOf("default")===0){return}try{var c=JSON.parse(b.data);a.callbackTrigger(c.name,c.parameters)}catch(d){}}};this.callbackRegister=function(b){a.callbackReigster(b)};this.callbackReigster=function(d){if(typeof d==="undefined"||d===null||d.constructor!==Object){return}var c=typeof d.name!=="undefined"?d.name:null;var b=typeof d.cb!=="undefined"?d.cb:null;if(typeof c==="string"&&typeof b==="function"){a.callbacks[c]=b}};this.callbackTrigger=function(c,d){if(typeof c==="string"&&typeof a.callbacks[c]==="function"){var b=a.callbacks[c](d);if(b===undefined){b=true}if(b){delete a.callbacks[c]}}};this.postMessage=function(c,d,b){a.callbackReigster(b);parent.postMessage(JSON.stringify({miniclip:true,data:{action:c,parameters:d||{}}}),"*")};this.api=function(d,f,b){if((typeof d!=="string"||d.length<=0)&&typeof b==="function"){return b({error:"No request entered",code:-1})}var c=d+":"+JSON.stringify(f);a.callbackReigster({name:c,cb:b});var e=a.setupEasyXdm(d);e.proxyLocal={postMessage:function(g){var i=typeof g.miniclip!=="undefined"&&g.miniclip===true;var j=typeof g.api!=="undefined"&&g.api===true;var k={},h=null;try{k=typeof g.data!=="undefined"?JSON.parse(decodeURIComponent(g.data)):{};h=a.objects[c]||null}catch(l){}if(i!==true||j!==true&&h!==null){return}h.easyxdm.destroy();a.callbackTrigger(c,k)}};MC.Modules.includeFile("easyxdm.js",{name:"easyXDM",cb:function(){var g=new easyXDM.Rpc(e.options,{remote:{open:{},postMessage:{}},local:e.proxyLocal});a.objects[c]={type:"api",name:c,easyxdm:g};g.postMessage({app_id:MC.appId,method:d,params:f})}})};this.open=function(d,b){a.callbackReigster(b);var c=b.name||d;if(d.indexOf("?")<0){d+="?"}if(a.lightbox===true&&window.top===window.self){console.info("Opening lightbox");a.openLightbox(c,d)}else{if(a.lightbox===true){console.info("Opening lightbox parent");a.openLightboxParent(c,d)}else{console.info("Opening pop up window");a.openDialog(c,d)}}};this.jsonp=function(c,d,b){a.callbackReigster(b);try{$.ajax({url:a.domain+c,type:"POST",dataType:"JSONP",jsonpCallback:"data",data:d||{}}).done(function(e){a.callbackTrigger(b.name,e)})}catch(f){}};this.environment=function(b){if(window.top===window.self){return b(true)}MC.Proxy.postMessage("environment",null,{name:"environment",cb:b})};this.openLightbox=function(c,d){d+="&request="+encodeURIComponent(location.protocol+"//"+location.host);console.info("src: ",a.getDomain(),d);var b=a.getDomain();Modal.open({action:c,header:"Sign in to Miniclip",type:"url",src:b+d,callback:function(e){if(a.isMainDomain()){if(e!==true){location.reload()}}else{a.callbackTrigger(c,e)}}})};this.openLightboxParent=function(b,c){c+="&request="+encodeURIComponent(location.protocol+"//"+location.host);MC.Proxy.postMessage(b,{request:c})};this.openDialog=function(b,c){var d=a.setupEasyXdm(c);d.proxyLocal={postMessage:function(f){var h=typeof f.miniclip!=="undefined"&&f.miniclip===true;var k={},j=null,i={},g=null;try{k=typeof f.data!=="undefined"?JSON.parse(decodeURIComponent(f.data)):{};j=typeof k.action!=="undefined"?k.action:null;i=typeof k.parameters!=="undefined"?k.parameters:{};g=a.objects[j]||null}catch(l){}if(h!==true||g===null){return}clearInterval(g.interval);g.easyxdm.destroy();a.callbackTrigger(j,i)}};MC.Modules.includeFile("easyxdm.js",{name:"easyXDM",cb:function(){var e=new easyXDM.Rpc(d.options,{remote:{open:{},postMessage:{}},local:d.proxyLocal});a.objects[b]={type:"dialog",name:b,window:window.open(d.loadingUrl,d.windowName,"width=500,height=500"),easyxdm:e,interval:setInterval(function(){a.closeDialog(b)},100)};e.open(d.requestUrl,d.windowName)}})};this.closeDialog=function(c){var b=a.objects[c];if(typeof b.window!=="undefined"&&b.window.closed){clearInterval(b.interval);b.easyxdm.destroy();MC.Proxy.callbackTrigger(b.name,{data:{cancelled:true}})}};this.setupEasyXdm=function(b){return{options:{swf:"/easyxdm/easyxdm.swf",remote:"https:"+a.domain+"/dialog/arbiter/"+MC.appId+"/"+MC.languageCode+"?request="+encodeURIComponent(location.protocol+"//"+location.host)},windowName:"MiniclipDialog",requestUrl:"https:"+a.domain+(b||""),loadingUrl:"https:"+a.domain+"/dialog/loading"}}};MC.Modules=new function(){var a=this;this.configs={};this.domain;this.valid="share,currency,social,leaderboard,challenge";this.included={};this.files={};this.init=function(b){a.domain=a.getDomain();a.load(b)};this.getConfig=function(b){if(b in a.configs){return a.configs[b]}return false};this.setConfig=function(c,b){if(c&&b){a.configs[c]=b;if(MC.Proxy.state==2){MC.Proxy.postMessage("module_init_config",{module:c,config:b})}}};this.getDomain=function(){if(typeof a.domain!=="undefined"){return a.domain}var b=document.getElementsByTagName("script");var c="//static.miniclipcdn.com";if(b&&b.length>0){for(var e in b){if(b[e].src&&b[e].src.match(/\/js\/mc\.js/)){var d=b[e].src.replace(/https?:\/\/(.+)\/js\/mc\.js.*$/,"$1");var f=d.split(".");if(f.length>3){f.shift()}return"//"+f.join(".")}}}return c};this.load=function(b,e){if(b.constructor!==Array){throw"The modules parameter must be an array"}var d;for(var c in b){if(b.hasOwnProperty(c)){d=b[c].toLowerCase();if(typeof e==="undefined"&&a.valid.indexOf(d)<0){MC.console("warn",'Module "'+d+'" is not a valid');continue}a.include(d)}}};this.include=function(b){a.included[b]=true;if(typeof(window.MC[b.charAt(0).toUpperCase()+b.slice(1)])!=="undefined"){MC.console("warn",'Module "'+b+'" already exists');return}a.includeFile(b.replace(/\./g,"/").toLowerCase()+".js")};this.includeFile=function(f,c){MC.Proxy.callbackReigster(c);if(typeof a.files[f]!=="undefined"){a.callbackTrigger(c);return}a.files[f]=true;var b=document.querySelector("body");var d=document.createElement("script");var e=b.dataset?b.dataset.scriptVersion:0;d.src=a.getDomain()+"/js/"+f+"?"+e;d.onload=a.callbackTrigger(c);b.appendChild(d)};this.callbackTrigger=function(c){if(typeof c==="undefined"){return}var e=0,d=1;var b=setInterval(function(){e+=d;try{if(typeof window[c.name]!=="undefined"){clearInterval(b);MC.Proxy.callbackTrigger(c.name)}}catch(f){}if(e>=5000){clearInterval(b);MC.console("error",'Object "'+c.name+'" took too long to load')}},d)}};MC.Header=new function(){var a=this;this.theme;this.init=function(b){a.theme=b.theme||"light";a.script_version=b.script_version||"1";a.css_version=b.css_version||"1";a.include()};this.include=function(){a.css();a.html()};this.css=function(){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",MC.Modules.getDomain()+"/css/mc.css?"+a.css_version);document.getElementsByTagName("head")[0].appendChild(b)};this.html=function(){var b=false,d="mc-header";var c=document.getElementById(d);if(c===null){b=true;c=document.createElement("div")}c.id=d;c.className="miniclip-global-header miniclip-global-header-"+a.theme;c.innerHTML='<div class="container"> '+a.sectionMain()+"</div>";if(b===true){document.body.insertBefore(c,document.body.firstChild)}};this.sectionMain=function(){return'<section id="miniclip-global-main" class="section section-main">            <a href="'+MC.Proxy.getDomain()+'" class="logo"></a>        </section>'}};MC.Cookies=new function(){var a=this;this.getItem=function(b){if(!b){return null}return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(b).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null};this.setItem=function(e,h,d,c,b,f){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e)){return false}var g="";if(d){switch(d.constructor){case Number:g=d===Infinity?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+d;break;case String:g="; expires="+d;break;case Date:g="; expires="+d.toUTCString();break}}document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(h)+g+(b?"; domain="+b:"")+(c?"; path="+c:"")+(f?"; secure":"");return true};this.removeItem=function(d,c,b){if(!a.hasItem(d)){return false}document.cookie=encodeURIComponent(d)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(b?"; domain="+b:"")+(c?"; path="+c:"");return true};this.hasItem=function(b){if(!b||/^(?:expires|max\-age|path|domain|secure)$/i.test(b)){return false}return(new RegExp("(?:^|;\\s*)"+encodeURIComponent(b).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie)};this.keys=function(){var b=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(var d=b.length,c=0;c<d;c++){b[c]=decodeURIComponent(b[c])}return b}};