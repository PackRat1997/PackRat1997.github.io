var Modal=new function(){var a=this;var b={};this.eventMethodAdd=window.addEventListener?"addEventListener":"attachEvent";this.eventMethodRemove=window.removeEventListener?"removeEventListener":"detachEvent";this.eventMessage=!window.addEventListener||!window.removeEventListener?"onmessage":"message";this.modal=$("<div/>").addClass("mc-modal");this.modalDialog=$("<div/>").addClass("mc-modal-dialog");this.modalContent=$("<div/>").addClass("mc-modal-content");this.modalHeader=$("<div/>").addClass("mc-modal-header");this.modalBody=$("<div/>").addClass("mc-modal-body");this.modalClose=$("<span/>").addClass("mc-close");this.modalCallback=null;this.frameHeight=0;this.domain;this.init=function(){a.actions()};this.actions=function(){$(window).on("resize",function(){a.resize(a.frameHeight)});$(document.body).on("click",".mc-modal .mc-close",function(){a.close(true);return false})};this.getDomain=function(){if(typeof a.domain!=="undefined"){return a.domain}var c=document.getElementsByTagName("script");var d="//static.miniclipcdn.com";if(c&&c.length>0){for(var f in c){if(c[f].src&&c[f].src.match(/\/js\/mc\.js/)){var e=c[f].src.replace(/https?:\/\/(.+)\/js\/mc\.js.*$/,"$1");var g=e.split(".");if(g.length>3){g.shift()}return"//"+g.join(".")}}}return d};this.open=function(c){if(typeof c==="undefined"||c===null||c.constructor!==Object){throw"Incorrect data format for modal"}this.modalDialog.removeClass("mc-modal-borderless");this.modalContent.removeClass("mc-modal-borderless");if(typeof c.borderless!=="undefined"&&c.borderless==true){this.modalDialog.addClass("mc-modal-borderless");this.modalContent.addClass("mc-modal-borderless")}switch(c.type){case"url":a.url(c.src);break;case"content":a.content(c.html);break;default:throw"Modal type not set"}a.header(c.header||null);if("action" in c){b[c.action]=c.callback||null}a.callback(c.callback||null);a.build()};this.close=function(c){a.listenerRemove();if(typeof a.modalCallback==="function"){a.modalCallback(c===true)}a.modalCallback=null;$(".mc-modal").remove();return false};this.header=function(c){a.modalHeader.html("");if(typeof c==="string"){a.modalHeader.html('<h1 class="title">'+c+"</h1>")}};this.callback=function(c){a.modalCallback=typeof c==="function"?c:null};this.url=function(d){var c=$("<iframe/>").addClass("mc-modal-iframe").attr({hidden:true,frameBorder:0,src:d});c.on("load",function(){$(".mc-modal-loading").remove();c.show()});a.loading();a.listenerAdd();a.modalBody.append(c)};this.content=function(c){a.modalBody.empty().append(c)};this.loading=function(){var c=$("<div/>").addClass("mc-modal-loading").html('<img src="'+a.getDomain()+'/images/loading/waiting64.gif" alt="Loading">');a.modalBody.html(c)};this.build=function(){a.modalHeader.append(a.modalClose.html('<a href="#">&times;</a>'));a.modalContent.append(a.modalHeader).append(a.modalBody);a.modalDialog.append(a.modalContent);a.modal.append(a.modalDialog);$("body").append(a.modal)};this.listenerAdd=function(){if(a.eventMethodAdd==="attachEvent"){window[a.eventMethodAdd](a.eventMessage,a.listener,false)}else{window[a.eventMethodAdd](a.eventMessage,a.listener)}};this.listenerRemove=function(){if(a.eventMethodRemove==="detachEvent"){window[a.eventMethodRemove](a.eventMessage,a.listener,false)}else{window[a.eventMethodRemove](a.eventMessage,a.listener)}};this.listener=function(f){var l={},c=false,i=false,k=false;try{l=JSON.parse(f.data);c=typeof l.miniclip!=="undefined"&&l.miniclip===true;i=typeof l.modal!=="undefined"&&l.modal===true;k=typeof l.close!=="undefined"&&l.close===true}catch(h){}if(c!==true||i!==true){return}var g=typeof l.data!=="undefined"?l.data:{};var d=typeof g.action!=="undefined"?g.action:null;var j=typeof g.parameters!=="undefined"?g.parameters:{};if(typeof a[d]==="function"){a[d](j)}if(typeof b[d]==="function"){b[d](j)}if(k===true){b[d]=null;a.close()}};this.resize=function(c){var e=$(".mc-modal-iframe");var g=e.position()||{};var h=window.innerHeight||document.documentElement.clientHeight;var d=h-((g.top||0)+$(".mc-modal-header").outerHeight(true));var f=100;a.frameHeight=c;if(!isNaN(c)&&c<=d){f=c}else{if(!isNaN(c)&&c>d){f=d}}e.height(f)}};$(document).ready(function(){Modal.init()});